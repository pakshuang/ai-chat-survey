# Setup

This document describes how to set up the project. It is intended to be read by developers and other technical stakeholders.

## Prerequisites

- [Docker](https://www.docker.com/)
- [Python](https://www.python.org/)


## Quick Installation For Windows

1. Clone the repository:

   ```shell
       git clone https://github.com/pakshuang/ai-chat-survey.git
   ```

2. Open the ai-chat-survey folder on Windows Explorer and click `installer_win.bat`.

3. Enter your `OPENAI_API_KEY` and follow the instructions in the file.

## Installation (General)

1. Clone the repository:

   ```shell
   git clone https://github.com/pakshuang/ai-chat-survey.git
   ```

2. Change into the project directory:

   ```shell
   cd ai-chat-survey
   ```

3. Initialise `.env` file:

   ```shell
   cp sample.env .env
   ```

4. Fill in the `.env` file with the necessary environment variables. Some of the variables are already filled in with default values.

## Running the Application

To run the application, use the following command:

```shell
docker-compose up --build
```

If you have already built the images, you can use the following command to start the application:

```shell
docker-compose up
```

During development, you may want to run the application on a clean slate. To do this, you can use the following command:

```shell
docker-compose up --build --force-recreate --renew-anon-volumes
```

To stop the application, use the following command:

```shell
docker-compose down
```

During development, you may want to stop the application and remove all images and volumes. To do this, you can use the following command:

```shell
docker-compose down --rmi all --volumes
```

## Backend Development

### Setting up the backend development environment

1. Install [pipenv](https://pypi.org/project/pipenv/):

   ```shell
   pip install pipenv
   ```

2. Navigate to the `backend` directory:

   ```shell
   cd backend
   ```

3. Create a virtual environment and install dependencies:

   ```shell
   pipenv install --dev
   ```

4. Adding dependencies:

   If you need to add a new dependency, use the following command:

   ```shell
   pipenv install <package-name>
   ```

   - Do not add the package directly to the `Pipfile`. The `Pipfile` and `Pipfile.lock` should be generated by `pipenv`.
   - You can specify if the package is a development dependency by adding the `--dev` flag.
   - Remember to commit the `Pipfile` and `Pipfile.lock` after adding a new dependency.

5. Running the backend:

   ```shell
   cp ../.env .env
   pipenv run python src/app.py
   ```

   The `.env` file is copied from the root directory to the `backend` directory. This is because telling `pipenv` to use the `.env` file in the root directory requires changing a global environment variable. This is not recommended as it can cause conflicts with other projects.

6. For more information on how to use `pipenv`, refer to the [official documentation](https://pipenv.pypa.io/en/latest/).

### Running the backend using Docker

1. Building the image

   ```shell
   docker build -t backend .
   ```

2. Running the image

   ```shell
   docker run --name backend -p 5000:5000 --env-file ../.env backend
   ```

The recommended way to run is to use docker compose instead, see [Running the Application](#running-the-application).

## Testing (Backend)

1. [Run the Application](#running-the-application)

   > [!IMPORTANT]
   > The tests assume that the application is running with a clean database. You should run the tests on a clean slate. For this reason, make sure that any dummy data added to the database upon launch does not interfere with the tests.

2. Run the tests

   ```shell
   docker compose exec backend pipenv install --dev
   docker compose exec backend pipenv run pytest --cov=src
   ```
